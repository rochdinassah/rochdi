#!/bin/bash

# author: rochdi nassah
# created: 2025/09/21

cd ~/Desktop/apk/$1

apktool b source
zipalign 4 source/dist/base.apk base.apk -f

rm -rf /tmp/keystore
echo "





yes" > /tmp/keystoregenargs
keytool -genkey -alias patched-apk -keyalg rsa -keysize 512 -validity 1 -keystore /tmp/keystore -keypass 123456 -storepass 123456 < /tmp/keystoregenargs

for file in ./*
do
  if [[ $file =~ \.apk$ ]]
  then
    apksigner sign --key-pass pass:123456 -ks-pass pass:123456 -ks-key-alias patched-apk -ks /tmp/keystore $file
  fi
done

search=$(adb shell pm list packages|grep $1)
if [ 0 != ${#search} ]
then
  adb uninstall $(echo $search | sed 's/package\://')
fi

adb install-multiple *.apk
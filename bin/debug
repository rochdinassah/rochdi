#!/usr/bin/env node

'use strict';

const rochdi = require('../');
const crypto = require('node:crypto');
const tls = require('node:tls');

const { HttpClient, formatDuration, rand, randomString, getTime } = rochdi;

const httpClient = new HttpClient({ xuserAgent: 'c', retryOnError: true });

const endpoint = {
  url: 'https://openai.com',
  headers: {
    'accept-encoding': 'gzip, deflate, br, zstd',
    qux: 16
  }
};

const { url, headers } = endpoint;

void async function () {

  httpClient.tryJAFingerprintBypass(url, { headers }, res => {
    const { statusCode } = res;
    if (403 === statusCode)
      return log('nope', statusCode), false;
    return true;
  }).then(result => {
    const { success, cipher, userAgent } = result;

    if (!success)
      exit('bypass error');

    exit('bypass ok, cipher: %s, userAgent:', cipher, userAgent);
  });

}();